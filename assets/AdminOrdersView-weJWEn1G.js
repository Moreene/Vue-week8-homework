import{a as v}from"./axios-G2rPRu76.js";import{M as P,A as E}from"./AdminPaginationComponent-321r3uEP.js";import{f as x}from"./date-8u4Ux2E5.js";import{s as p}from"./sweetalert-0QGWzoUc.js";import{_ as M,h as i,o as n,c as a,b as e,t as d,i as c,j as T,e as C,f as _,v as b,n as A,K as D,d as O,F as g,r as I,u as L,w}from"./index-eJtnKc-e.js";var S={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:U,VITE_APIPATH:R}=S,H={props:["tempOrder"],data(){return{order:{},editOrderModal:null}},methods:{updateOrder(){v.put(`${U}/api/${R}/admin/order/${this.tempOrder.id}`,{data:this.order}).then(r=>{p("success",r.data.message),this.$emit("updateOrder"),this.$emit("clearInput"),this.editOrderModal.hide()}).catch(r=>{p("error",r.response.data.message)})},resetForm(){this.$refs.form.resetForm()}},computed:{date(){return x(this.order.paid_date*1e3)}},watch:{tempOrder(){this.order=JSON.parse(JSON.stringify(this.tempOrder))}},mounted(){this.editOrderModal=new P(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},B={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-dialog-centered modal-xl"},F={class:"modal-content border-0"},q={class:"modal-header bg-primary text-white"},j={id:"editOrderModalLabel",class:"modal-title"},z={class:"modal-body"},J={class:"h5 fw-bold"},K={class:"d-block d-sm-inline"},G={class:"h5 fw-bold"},Q={class:"row py-24"},W={class:"col-lg-6"},X={key:0,class:"row gy-16"},Y={class:"col-md-6"},Z=e("label",{for:"people",class:"form-label"},"訂購人",-1),ee={class:"col-md-6"},te=e("label",{for:"phone",class:"form-label"},"手機",-1),oe={class:"col-md-6"},se=e("label",{for:"mail",class:"form-label"},"信箱",-1),re={class:"col-md-6"},de=e("label",{for:"address",class:"form-label"},"地址",-1),le={class:"col-12"},ne=e("label",{for:"extarea"},"留言",-1),ae={key:0,class:"col-12"},ie={class:"form-check"},ce=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),me={class:"col-lg-6"},ue={key:0},_e=e("hr",{class:"my-8"},null,-1),pe={class:"ps-16 py-8"},he=e("hr",{class:"my-8"},null,-1),fe={class:"modal-footer"},be=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1);function Oe(r,o,h,V,t,l){const m=i("v-field"),y=i("error-message"),k=i("v-form");return n(),a("div",B,[e("div",N,[e("div",F,[e("div",q,[e("h5",j,[e("span",null,d(t.order.id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=f=>r.$emit("clearInput"))})]),e("div",z,[c(k,{ref:"form",onSubmit:l.updateOrder},{default:T(({errors:f})=>[e("h2",J,[C("訂單編號："),e("span",K,d(t.order.id),1)]),e("h2",G,"訂單日期："+d(t.order.paid_date?l.date:"未成立"),1),e("div",Q,[e("div",W,[t.order.user?(n(),a("div",X,[e("div",Y,[Z,_(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>t.order.user.name=s),readonly:""},null,512),[[b,t.order.user.name]])]),e("div",ee,[te,_(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>t.order.user.tel=s),readonly:""},null,512),[[b,t.order.user.tel]])]),e("div",oe,[se,_(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>t.order.user.email=s),readonly:""},null,512),[[b,t.order.user.email]])]),e("div",re,[de,c(m,{id:"address",name:"地址",type:"text",class:A(["form-control",{"is-invalid":f.地址}]),modelValue:t.order.user.address,"onUpdate:modelValue":o[4]||(o[4]=s=>t.order.user.address=s),rules:"required"},null,8,["modelValue","class"]),c(y,{name:"地址",class:"invalid-feedback"})]),e("div",le,[ne,_(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":o[5]||(o[5]=s=>t.order.message=s)},null,512),[[b,t.order.message]])]),t.order.is_paid?O("",!0):(n(),a("div",ae,[e("div",ie,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=s=>t.order.is_paid=s),id:"check"},null,512),[[D,t.order.is_paid]]),ce])]))])):O("",!0)]),e("div",me,[t.order&&t.order.products?(n(),a("div",ue," 訂購內容 ("+d(Object.keys(t.order.products).length)+") ",1)):O("",!0),_e,e("ol",pe,[(n(!0),a(g,null,I(t.order.products,s=>(n(),a("li",{key:s.id},d(s.product.title)+" x "+d(s.qty),1))),128))]),he,e("p",null,"總金額：NT$ "+d(Math.round(t.order.total)),1)])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:o[7]||(o[7]=s=>r.$emit("clearInput"))}," 取消 "),be])]),_:1},8,["onSubmit"])])])])],512)}const ge=M(H,[["render",Oe]]);var ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ye,VITE_APIPATH:ke}=ve,Ie={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){v.delete(`${ye}/api/${ke}/admin/order/${this.tempOrder.id}`).then(r=>{p("success",r.data.message),this.$emit("updateOrder"),this.delOrderModal.hide()}).catch(r=>{p("error",r.response.data.message)})}},mounted(){this.delOrderModal=new P(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},Me={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ve={class:"modal-dialog modal-dialog-centered"},we={class:"modal-content border-0"},Pe={class:"modal-header bg-danger text-white"},xe={id:"delOrderModalLabel",class:"modal-title"},Ae=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),$e={class:"modal-body text-center p-24"},Ee={class:"fs-5"},Te={class:"modal-footer border-0 justify-content-center"},Ce=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1);function De(r,o,h,V,t,l){return n(),a("div",Me,[e("div",Ve,[e("div",we,[e("div",Pe,[e("h5",xe,[e("span",null,d(h.tempOrder.id),1)]),Ae]),e("div",$e,[e("span",Ee,'是否要刪除 "'+d(h.tempOrder.id)+'" 訂單?',1)]),e("div",Te,[Ce,e("button",{type:"button",class:"btn btn-danger w-25",onClick:o[0]||(o[0]=(...m)=>l.delProduct&&l.delProduct(...m))}," 確認刪除 ")])])])],512)}const Le=M(Ie,[["render",De]]);var Se={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:Ue,VITE_APIPATH:Re}=Se,He={components:{OrderModalComponent:ge,DelOrderModalComponent:Le,AdminPaginationComponent:E},data(){return{orders:[],tempOrder:{},pagination:{},isLoading:!1}},methods:{getOrders(r=1){this.isLoading=!0,v.get(`${Ue}/api/${Re}/admin/orders?page=${r}`).then(o=>{this.orders=o.data.orders,this.pagination=o.data.pagination,this.isLoading=!1}).catch(o=>{p("error",o.response.data.message)})},openModal(r,o){r==="edit"?(this.tempOrder={...o},this.$refs.modal.editOrderModal.show()):r==="delete"&&(this.tempOrder={...o},this.$refs.delModal.delOrderModal.show())},clearInput(){this.tempOrder={},this.$refs.modal.resetForm()}},computed:{date(){return this.orders.map(r=>x(r.paid_date*1e3))}},mounted(){const r=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");v.defaults.headers.common.Authorization=r,this.getOrders()}},Be={class:"container py-144"},Ne=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),Fe={class:"table-responsive mb-16"},qe={class:"table align-middle"},je=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),ze={class:"text-nowrap text-center"},Je={class:"ps-0 mb-0 list-unstyled text-center"},Ke=["onClick"],Ge=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),Qe=[Ge],We=["onClick"],Xe=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Ye=[Xe];function Ze(r,o,h,V,t,l){const m=i("VueLoading"),y=i("AdminPaginationComponent"),k=i("OrderModalComponent"),f=i("DelOrderModalComponent");return n(),a(g,null,[c(m,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=s=>t.isLoading=s),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",Be,[Ne,e("div",Fe,[e("table",qe,[je,e("tbody",ze,[(n(!0),a(g,null,I(t.orders,(s,$)=>(n(),a("tr",{key:s.id},[e("td",null,d(s.paid_date?l.date[$]:"未成立"),1),e("td",null,d(s.id),1),e("td",null,d(s.user.name),1),e("td",null,d(s.user.tel),1),e("td",null,[e("ul",Je,[(n(!0),a(g,null,I(s.products,u=>(n(),a("li",{key:u.product_id},d(u.product.title)+" * "+d(u.qty),1))),128))])]),e("td",null,"$ "+d(Math.round(s.total)),1),e("td",null,[e("span",{class:A({"text-danger":s.is_paid===!1})},d(s.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:w(u=>l.openModal("edit",s),["prevent"])},Qe,8,Ke)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:w(u=>l.openModal("delete",s),["prevent"])},Ye,8,We)])]))),128))])])]),t.pagination.total_pages>1?(n(),L(y,{key:0,pagination:t.pagination,onEmitPages:l.getOrders},null,8,["pagination","onEmitPages"])):O("",!0),c(k,{ref:"modal","temp-order":t.tempOrder,onClearInput:l.clearInput,onUpdateOrder:l.getOrders},null,8,["temp-order","onClearInput","onUpdateOrder"]),c(f,{ref:"delModal","temp-order":t.tempOrder,onUpdateOrder:l.getOrders},null,8,["temp-order","onUpdateOrder"])])],64)}const dt=M(He,[["render",Ze]]);export{dt as default};

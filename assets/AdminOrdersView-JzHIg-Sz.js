import{a as M}from"./axios-G2rPRu76.js";import{M as P,A as E}from"./AdminPaginationComponent--h0BlpKw.js";import{f as x}from"./date-8u4Ux2E5.js";import{s as u}from"./sweetalert-tDfAiNOE.js";import{_ as I,h as i,o as a,c as n,b as e,t as r,i as c,j as T,e as C,f as p,v as b,n as A,M as L,d as O,F as g,r as k,y as D,w}from"./index-YTSL6Rgu.js";var S={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:U,VITE_APIPATH:R}=S,H={props:["tempOrder"],data(){return{order:{},editOrderModal:null}},methods:{updateOrder(){M.put(`${U}/api/${R}/admin/order/${this.tempOrder.id}`,{data:this.order}).then(d=>{u("success",d.data.message),this.$emit("updateOrder"),this.$emit("clearInput"),this.editOrderModal.hide()}).catch(d=>{u("error",d.response.data.message)})},resetForm(){this.$refs.form.resetForm()}},computed:{date(){return x(this.order.paid_date*1e3)}},watch:{tempOrder(){this.order=JSON.parse(JSON.stringify(this.tempOrder))}},mounted(){this.editOrderModal=new P(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},B={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-dialog-centered modal-xl"},F={class:"modal-content border-0"},q={class:"modal-header bg-primary text-white"},j={id:"editOrderModalLabel",class:"modal-title"},J={class:"modal-body"},z={class:"h5 fw-bold"},G={class:"d-block d-sm-inline"},K={class:"h5 fw-bold"},Q={class:"row py-24"},W={class:"col-lg-6"},X={key:0,class:"row gy-16"},Y={class:"col-md-6"},Z=e("label",{for:"people",class:"form-label"},"訂購人",-1),ee={class:"col-md-6"},te=e("label",{for:"phone",class:"form-label"},"手機",-1),oe={class:"col-md-6"},se=e("label",{for:"mail",class:"form-label"},"信箱",-1),de={class:"col-md-6"},re=e("label",{for:"address",class:"form-label"},"地址",-1),le={class:"col-12"},ae=e("label",{for:"extarea"},"留言",-1),ne={key:0,class:"col-12"},ie={class:"form-check"},ce=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),_e={class:"col-lg-6"},me={key:0},pe=e("hr",{class:"my-8"},null,-1),ue={class:"ps-16 py-8"},he=e("hr",{class:"my-8"},null,-1),fe={class:"modal-footer"},be=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1);function Oe(d,o,h,V,t,l){const _=i("v-field"),v=i("error-message"),y=i("v-form");return a(),n("div",B,[e("div",N,[e("div",F,[e("div",q,[e("h5",j,[e("span",null,r(t.order.id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=f=>d.$emit("clearInput"))})]),e("div",J,[c(y,{ref:"form",onSubmit:l.updateOrder},{default:T(({errors:f})=>[e("h2",z,[C("訂單編號："),e("span",G,r(t.order.id),1)]),e("h2",K,"訂單日期："+r(t.order.paid_date?l.date:"未成立"),1),e("div",Q,[e("div",W,[t.order.user?(a(),n("div",X,[e("div",Y,[Z,p(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>t.order.user.name=s),readonly:""},null,512),[[b,t.order.user.name]])]),e("div",ee,[te,p(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>t.order.user.tel=s),readonly:""},null,512),[[b,t.order.user.tel]])]),e("div",oe,[se,p(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>t.order.user.email=s),readonly:""},null,512),[[b,t.order.user.email]])]),e("div",de,[re,c(_,{id:"address",name:"地址",type:"text",class:A(["form-control",{"is-invalid":f.地址}]),modelValue:t.order.user.address,"onUpdate:modelValue":o[4]||(o[4]=s=>t.order.user.address=s),rules:"required"},null,8,["modelValue","class"]),c(v,{name:"地址",class:"invalid-feedback"})]),e("div",le,[ae,p(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":o[5]||(o[5]=s=>t.order.message=s)},null,512),[[b,t.order.message]])]),t.order.is_paid?O("",!0):(a(),n("div",ne,[e("div",ie,[p(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=s=>t.order.is_paid=s),id:"check"},null,512),[[L,t.order.is_paid]]),ce])]))])):O("",!0)]),e("div",_e,[t.order&&t.order.products?(a(),n("div",me," 訂購內容 ("+r(Object.keys(t.order.products).length)+") ",1)):O("",!0),pe,e("ol",ue,[(a(!0),n(g,null,k(t.order.products,s=>(a(),n("li",{key:s.id},r(s.product.title)+" x "+r(s.qty),1))),128))]),he,e("p",null,"總金額：NT$ "+r(Math.round(t.order.total)),1)])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:o[7]||(o[7]=s=>d.$emit("clearInput"))}," 取消 "),be])]),_:1},8,["onSubmit"])])])])],512)}const ge=I(H,[["render",Oe]]);var ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ye,VITE_APIPATH:ke}=ve,Me={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){M.delete(`${ye}/api/${ke}/admin/order/${this.tempOrder.id}`).then(d=>{u("success",d.data.message),this.$emit("updateOrder"),this.delOrderModal.hide()}).catch(d=>{u("error",d.response.data.message)})}},mounted(){this.delOrderModal=new P(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},Ie={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ve={class:"modal-dialog modal-dialog-centered"},we={class:"modal-content border-0"},Pe={class:"modal-header bg-danger text-white"},xe={id:"delOrderModalLabel",class:"modal-title"},Ae=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),$e={class:"modal-body text-center p-24"},Ee={class:"fs-5"},Te={class:"modal-footer border-0 justify-content-center"},Ce=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1);function Le(d,o,h,V,t,l){return a(),n("div",Ie,[e("div",Ve,[e("div",we,[e("div",Pe,[e("h5",xe,[e("span",null,r(h.tempOrder.id),1)]),Ae]),e("div",$e,[e("span",Ee,'是否要刪除 "'+r(h.tempOrder.id)+'" 訂單?',1)]),e("div",Te,[Ce,e("button",{type:"button",class:"btn btn-danger w-25",onClick:o[0]||(o[0]=(..._)=>l.delProduct&&l.delProduct(..._))}," 確認刪除 ")])])])],512)}const De=I(Me,[["render",Le]]);var Se={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",BASE_URL:"/Vue-week8-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:Ue,VITE_APIPATH:Re}=Se,He={components:{OrderModalComponent:ge,DelOrderModalComponent:De,AdminPaginationComponent:E},data(){return{orders:[],tempOrder:{},pagination:{},isLoading:!1}},methods:{getOrders(d=1){this.isLoading=!0,M.get(`${Ue}/api/${Re}/admin/orders?page=${d}`).then(o=>{this.orders=o.data.orders,this.pagination=o.data.pagination,this.isLoading=!1}).catch(o=>{this.isLoading=!1,u("error",o.response.data.message)})},openModal(d,o){d==="edit"?(this.tempOrder={...o},this.$refs.modal.editOrderModal.show()):d==="delete"&&(this.tempOrder={...o},this.$refs.delModal.delOrderModal.show())},clearInput(){this.tempOrder={},this.$refs.modal.resetForm()}},computed:{date(){return this.orders.map(d=>x(d.paid_date*1e3))}},mounted(){this.getOrders()}},Be={class:"container py-144"},Ne=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),Fe={class:"table-responsive mb-16"},qe={class:"table align-middle"},je=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),Je={class:"text-nowrap text-center"},ze={class:"ps-0 mb-0 list-unstyled text-center"},Ge=["onClick"],Ke=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),Qe=[Ke],We=["onClick"],Xe=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Ye=[Xe];function Ze(d,o,h,V,t,l){const _=i("VueLoading"),v=i("AdminPaginationComponent"),y=i("OrderModalComponent"),f=i("DelOrderModalComponent");return a(),n(g,null,[c(_,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=s=>t.isLoading=s),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",Be,[Ne,e("div",Fe,[e("table",qe,[je,e("tbody",Je,[(a(!0),n(g,null,k(t.orders,(s,$)=>(a(),n("tr",{key:s.id},[e("td",null,r(s.paid_date?l.date[$]:"未成立"),1),e("td",null,r(s.id),1),e("td",null,r(s.user.name),1),e("td",null,r(s.user.tel),1),e("td",null,[e("ul",ze,[(a(!0),n(g,null,k(s.products,m=>(a(),n("li",{key:m.product_id},r(m.product.title)+" * "+r(m.qty),1))),128))])]),e("td",null,"$ "+r(Math.round(s.total)),1),e("td",null,[e("span",{class:A({"text-danger":s.is_paid===!1})},r(s.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:w(m=>l.openModal("edit",s),["prevent"])},Qe,8,Ge)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:w(m=>l.openModal("delete",s),["prevent"])},Ye,8,We)])]))),128))])])]),t.pagination.total_pages>1?(a(),D(v,{key:0,pagination:t.pagination,onEmitPages:l.getOrders},null,8,["pagination","onEmitPages"])):O("",!0),c(y,{ref:"modal","temp-order":t.tempOrder,onClearInput:l.clearInput,onUpdateOrder:l.getOrders},null,8,["temp-order","onClearInput","onUpdateOrder"]),c(f,{ref:"delModal","temp-order":t.tempOrder,onUpdateOrder:l.getOrders},null,8,["temp-order","onUpdateOrder"])])],64)}const rt=I(He,[["render",Ze]]);export{rt as default};
